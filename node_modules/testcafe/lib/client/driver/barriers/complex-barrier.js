"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const request_1 = __importDefault(require("./request"));
const script_execution_1 = __importDefault(require("./script-execution"));
// @ts-ignore
const hammerhead_1 = require("../deps/hammerhead");
class BarriersComplex {
    constructor(reqEmitter, scriptEmitter, unloadBarrier) {
        this._requestBarrier = new request_1.default(reqEmitter);
        this._scriptExecutionBarrier = new script_execution_1.default(scriptEmitter);
        this._unloadBarrier = unloadBarrier;
        if (unloadBarrier.watchForPageNavigationTriggers)
            unloadBarrier.watchForPageNavigationTriggers();
    }
    wait() {
        return hammerhead_1.Promise.all([
            // NOTE: script can be added by xhr-request, so we should run
            // script execution barrier waiting after request barrier resolved
            this._requestBarrier.wait()
                .then(() => this._scriptExecutionBarrier.wait()),
            this._unloadBarrier.wait(),
        ]).then();
    }
}
exports.default = BarriersComplex;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcGxleC1iYXJyaWVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NsaWVudC9kcml2ZXIvYmFycmllcnMvY29tcGxleC1iYXJyaWVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsd0RBQXVDO0FBQ3ZDLDBFQUF3RDtBQUV4RCxhQUFhO0FBQ2IsbURBQTZDO0FBUTdDLE1BQXFCLGVBQWU7SUFLaEMsWUFBb0IsVUFBbUMsRUFBRSxhQUF3QyxFQUFFLGFBQWdDO1FBQy9ILElBQUksQ0FBQyxlQUFlLEdBQVcsSUFBSSxpQkFBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzlELElBQUksQ0FBQyx1QkFBdUIsR0FBRyxJQUFJLDBCQUFzQixDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3pFLElBQUksQ0FBQyxjQUFjLEdBQVksYUFBYSxDQUFDO1FBRTdDLElBQUksYUFBYSxDQUFDLDhCQUE4QjtZQUM1QyxhQUFhLENBQUMsOEJBQThCLEVBQUUsQ0FBQztJQUN2RCxDQUFDO0lBRU0sSUFBSTtRQUNQLE9BQU8sb0JBQU8sQ0FBQyxHQUFHLENBQUM7WUFDZiw2REFBNkQ7WUFDN0Qsa0VBQWtFO1lBQ2xFLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFO2lCQUN0QixJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLElBQUksRUFBRSxDQUFDO1lBRXBELElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFO1NBQzdCLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNkLENBQUM7Q0FDSjtBQXhCRCxrQ0F3QkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVxdWVzdEJhcnJpZXIgZnJvbSAnLi9yZXF1ZXN0JztcbmltcG9ydCBTY3JpcHRFeGVjdXRpb25CYXJyaWVyIGZyb20gJy4vc2NyaXB0LWV4ZWN1dGlvbic7XG5pbXBvcnQgeyBDbGllbnRSZXF1ZXN0RW1pdHRlciwgU2NyaXB0RXhlY3V0aW9uRW1pdHRlciB9IGZyb20gJy4uLy4uLy4uL3NoYXJlZC90eXBlcyc7XG4vLyBAdHMtaWdub3JlXG5pbXBvcnQgeyBQcm9taXNlIH0gZnJvbSAnLi4vZGVwcy9oYW1tZXJoZWFkJztcblxuXG5pbnRlcmZhY2UgUGFnZVVubG9hZEJhcnJpZXIge1xuICAgIHdhdGNoRm9yUGFnZU5hdmlnYXRpb25UcmlnZ2Vycz86ICgpID0+IHZvaWQ7XG4gICAgd2FpdDogKCkgPT4gUHJvbWlzZTx2b2lkPjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQmFycmllcnNDb21wbGV4PFIsIFM+IHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9yZXF1ZXN0QmFycmllcjogUmVxdWVzdEJhcnJpZXI8Uj47XG4gICAgcHJpdmF0ZSByZWFkb25seSBfc2NyaXB0RXhlY3V0aW9uQmFycmllcjogU2NyaXB0RXhlY3V0aW9uQmFycmllcjxTPjtcbiAgICBwcml2YXRlIHJlYWRvbmx5IF91bmxvYWRCYXJyaWVyOiBQYWdlVW5sb2FkQmFycmllcjtcblxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvciAocmVxRW1pdHRlcjogQ2xpZW50UmVxdWVzdEVtaXR0ZXI8Uj4sIHNjcmlwdEVtaXR0ZXI6IFNjcmlwdEV4ZWN1dGlvbkVtaXR0ZXI8Uz4sIHVubG9hZEJhcnJpZXI6IFBhZ2VVbmxvYWRCYXJyaWVyKSB7XG4gICAgICAgIHRoaXMuX3JlcXVlc3RCYXJyaWVyICAgICAgICAgPSBuZXcgUmVxdWVzdEJhcnJpZXIocmVxRW1pdHRlcik7XG4gICAgICAgIHRoaXMuX3NjcmlwdEV4ZWN1dGlvbkJhcnJpZXIgPSBuZXcgU2NyaXB0RXhlY3V0aW9uQmFycmllcihzY3JpcHRFbWl0dGVyKTtcbiAgICAgICAgdGhpcy5fdW5sb2FkQmFycmllciAgICAgICAgICA9IHVubG9hZEJhcnJpZXI7XG5cbiAgICAgICAgaWYgKHVubG9hZEJhcnJpZXIud2F0Y2hGb3JQYWdlTmF2aWdhdGlvblRyaWdnZXJzKVxuICAgICAgICAgICAgdW5sb2FkQmFycmllci53YXRjaEZvclBhZ2VOYXZpZ2F0aW9uVHJpZ2dlcnMoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgd2FpdCAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICAvLyBOT1RFOiBzY3JpcHQgY2FuIGJlIGFkZGVkIGJ5IHhoci1yZXF1ZXN0LCBzbyB3ZSBzaG91bGQgcnVuXG4gICAgICAgICAgICAvLyBzY3JpcHQgZXhlY3V0aW9uIGJhcnJpZXIgd2FpdGluZyBhZnRlciByZXF1ZXN0IGJhcnJpZXIgcmVzb2x2ZWRcbiAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RCYXJyaWVyLndhaXQoKVxuICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHRoaXMuX3NjcmlwdEV4ZWN1dGlvbkJhcnJpZXIud2FpdCgpKSxcblxuICAgICAgICAgICAgdGhpcy5fdW5sb2FkQmFycmllci53YWl0KCksXG4gICAgICAgIF0pLnRoZW4oKTtcbiAgICB9XG59XG4iXX0=